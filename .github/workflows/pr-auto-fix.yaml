name: PR AutoFix
on: [push]
jobs:
  PRAutoFix:
    runs-on: ubuntu-latest
    steps:
      # Cancel current runs if they're still running
      # (saves processing on fast pushes)
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.1
        with:
          access_token: ${{ github.token }}
      # Allow opt-out for some users
      - name: Should I Stay Or Should I Go
        uses: actions/github-script@v4
        id: check
        with:
          script: |
            // If you'd like not to run this code on your commits, add your github user id here:
            NO_AUTOFIX_USERS = []
            const { owner, repo } = context.repo
            if (NO_AUTOFIX_USERS.includes(context.actor)) {
              console.log('Cancelling');
              const run_id = "${{ github.run_id }}";
              await github.actions.cancelWorkflowRun({ owner, repo, run_id });
              return 'go';
            } else {
              return 'stay';
            }
      - name: Wait for cancellation
        run: sleep 60
        if: steps.check.outputs.result == 'go'
      - name: Should build?
        run: test "${{ steps.check.outputs.result }}" = "stay"
      # Setup to run sanity suite

